function detectBrowser(t){function n(n){return n.concat(n[1].exec(t))}function e(t){return!!t[2]}var i=[["edge",/Edge\/([0-9\._]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+)\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/iPad.*Version\/([0-9\._]+)/],["ios",/iPhone.*Version\/([0-9\._]+)/],["safari",/Version\/([0-9\._]+).*Safari/]],o=0,s=[];for(o=0;o<i.length;o++)i[o]=n(i[o]),e(i[o])&&s.push(i[o]);for(var c=s[0],r=c&&c[3].split(/[._]/).slice(0,3);r&&r.length<3;)r.push("0");return{name:c&&c[0],version:r&&r.join(".")}}function cl(t){console.log(t)}(function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};this.WebSocketRails=function(){function n(n,e){this.url=n,this.use_websockets=null==e||e,this.connection_stale=t(this.connection_stale,this),this.pong=t(this.pong,this),this.supports_websockets=t(this.supports_websockets,this),this.dispatch_channel=t(this.dispatch_channel,this),this.unsubscribe=t(this.unsubscribe,this),this.subscribe_private=t(this.subscribe_private,this),this.subscribe=t(this.subscribe,this),this.dispatch=t(this.dispatch,this),this.trigger_event=t(this.trigger_event,this),this.trigger=t(this.trigger,this),this.unbind=t(this.unbind,this),this.bind=t(this.bind,this),this.connection_established=t(this.connection_established,this),this.new_message=t(this.new_message,this),this.reconnect=t(this.reconnect,this),this.callbacks={},this.channels={},this.queue={},this.connect()}return n.prototype.connect=function(){return this.state="connecting",this._conn=this.supports_websockets()&&this.use_websockets?new n.WebSocketConnection(this.url,this):new n.HttpConnection(this.url,this),this._conn.new_message=this.new_message},n.prototype.disconnect=function(){return this._conn&&(this._conn.close(),delete this._conn._conn,delete this._conn),this.state="disconnected"},n.prototype.reconnect=function(){var t,n,e,i,o;e=null!=(i=this._conn)?i.connection_id:void 0,this.disconnect(),this.connect(),o=this.queue;for(n in o)t=o[n],t.connection_id!==e||t.is_result()||this.trigger_event(t);return this.reconnect_channels()},n.prototype.new_message=function(t){var e,i,o,s,c,r;for(r=[],o=0,s=t.length;s>o;o++)i=t[o],e=new n.Event(i),e.is_result()?(null!=(c=this.queue[e.id])&&c.run_callbacks(e.success,e.data),delete this.queue[e.id]):e.is_channel()?this.dispatch_channel(e):e.is_ping()?this.pong():this.dispatch(e),r.push("connecting"===this.state&&"client_connected"===e.name?this.connection_established(e.data):void 0);return r},n.prototype.connection_established=function(t){return this.state="connected",this._conn.setConnectionId(t.connection_id),this._conn.flush_queue(),null!=this.on_open?this.on_open(t):void 0},n.prototype.bind=function(t,n){var e;return null==(e=this.callbacks)[t]&&(e[t]=[]),this.callbacks[t].push(n)},n.prototype.unbind=function(t){return delete this.callbacks[t]},n.prototype.trigger=function(t,e,i,o){var s,c;return s=new n.Event([t,e,null!=(c=this._conn)?c.connection_id:void 0],i,o),this.trigger_event(s)},n.prototype.trigger_event=function(t){var n,e;return null==(n=this.queue)[e=t.id]&&(n[e]=t),this._conn&&this._conn.trigger(t),t},n.prototype.dispatch=function(t){var n,e,i,o,s;if(null!=this.callbacks[t.name]){for(o=this.callbacks[t.name],s=[],e=0,i=o.length;i>e;e++)n=o[e],s.push(n(t.data));return s}},n.prototype.subscribe=function(t,e,i){var o;return null==this.channels[t]?(o=new n.Channel(t,this,(!1),e,i),this.channels[t]=o,o):this.channels[t]},n.prototype.subscribe_private=function(t,e,i){var o;return null==this.channels[t]?(o=new n.Channel(t,this,(!0),e,i),this.channels[t]=o,o):this.channels[t]},n.prototype.unsubscribe=function(t){return null!=this.channels[t]?(this.channels[t].destroy(),delete this.channels[t]):void 0},n.prototype.dispatch_channel=function(t){return null!=this.channels[t.channel]?this.channels[t.channel].dispatch(t.name,t.data):void 0},n.prototype.supports_websockets=function(){return"function"==typeof WebSocket||"object"==typeof WebSocket},n.prototype.pong=function(){var t,e;return t=new n.Event(["websocket_rails.pong",{},null!=(e=this._conn)?e.connection_id:void 0]),this._conn.trigger(t)},n.prototype.connection_stale=function(){return"connected"!==this.state},n.prototype.reconnect_channels=function(){var t,n,e,i,o;i=this.channels,o=[];for(e in i)n=i[e],t=n._callbacks,n.destroy(),delete this.channels[e],n=n.is_private?this.subscribe_private(e):this.subscribe(e),n._callbacks=t,o.push(n);return o},n}()}).call(this),function(){WebSocketRails.Event=function(){function t(t,n,e){var i;this.success_callback=n,this.failure_callback=e,this.name=t[0],i=t[1],null!=i&&(this.id=null!=i.id?i.id:65536*(1+Math.random())|0,this.channel=null!=i.channel?i.channel:void 0,this.data=null!=i.data?i.data:i,this.token=null!=i.token?i.token:void 0,this.connection_id=t[2],null!=i.success&&(this.result=!0,this.success=i.success))}return t.prototype.is_channel=function(){return null!=this.channel},t.prototype.is_result=function(){return"undefined"!=typeof this.result},t.prototype.is_ping=function(){return"websocket_rails.ping"===this.name},t.prototype.serialize=function(){return JSON.stringify([this.name,this.attributes()])},t.prototype.attributes=function(){return{id:this.id,channel:this.channel,data:this.data,token:this.token}},t.prototype.run_callbacks=function(t,n){return this.success=t,this.result=n,this.success===!0?"function"==typeof this.success_callback?this.success_callback(this.result):void 0:"function"==typeof this.failure_callback?this.failure_callback(this.result):void 0},t}()}.call(this),function(){WebSocketRails.AbstractConnection=function(){function t(t,n){this.dispatcher=n,this.message_queue=[]}return t.prototype.close=function(){},t.prototype.trigger=function(t){return"connected"!==this.dispatcher.state?this.message_queue.push(t):this.send_event(t)},t.prototype.send_event=function(t){return null!=this.connection_id?t.connection_id=this.connection_id:void 0},t.prototype.on_close=function(t){var n;return this.dispatcher&&this.dispatcher._conn===this?(n=new WebSocketRails.Event(["connection_closed",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(n)):void 0},t.prototype.on_error=function(t){var n;return this.dispatcher&&this.dispatcher._conn===this?(n=new WebSocketRails.Event(["connection_error",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(n)):void 0},t.prototype.on_message=function(t){return this.dispatcher&&this.dispatcher._conn===this?this.dispatcher.new_message(t):void 0},t.prototype.setConnectionId=function(t){this.connection_id=t},t.prototype.flush_queue=function(){var t,n,e,i;for(i=this.message_queue,n=0,e=i.length;e>n;n++)t=i[n],this.trigger(t);return this.message_queue=[]},t}()}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var o in e)t.call(e,o)&&(n[o]=e[o]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};WebSocketRails.WebSocketConnection=function(t){function e(t,n){this.url=t,this.dispatcher=n,e.__super__.constructor.apply(this,arguments),this.url.match(/^wss?:\/\//)?console.log("WARNING: Using connection urls with protocol specified is depricated"):this.url="https:"===window.location.protocol?"wss://"+this.url:"ws://"+this.url,this._conn=new WebSocket(this.url),this._conn.onmessage=function(t){return function(n){var e;return e=JSON.parse(n.data),t.on_message(e)}}(this),this._conn.onclose=function(t){return function(n){return t.on_close(n)}}(this),this._conn.onerror=function(t){return function(n){return t.on_error(n)}}(this)}return n(e,t),e.prototype.connection_type="websocket",e.prototype.close=function(){return this._conn.close()},e.prototype.send_event=function(t){return e.__super__.send_event.apply(this,arguments),this._conn.send(t.serialize())},e}(WebSocketRails.AbstractConnection)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};WebSocketRails.Channel=function(){function n(n,e,i,o,s){var c,r,a;this.name=n,this._dispatcher=e,this.is_private=null!=i&&i,this.on_success=o,this.on_failure=s,this._failure_launcher=t(this._failure_launcher,this),this._success_launcher=t(this._success_launcher,this),this._callbacks={},this._token=void 0,this._queue=[],r=this.is_private?"websocket_rails.subscribe_private":"websocket_rails.subscribe",this.connection_id=null!=(a=this._dispatcher._conn)?a.connection_id:void 0,c=new WebSocketRails.Event([r,{data:{channel:this.name}},this.connection_id],this._success_launcher,this._failure_launcher),this._dispatcher.trigger_event(c)}return n.prototype.destroy=function(){var t,n,e;return this.connection_id===(null!=(e=this._dispatcher._conn)?e.connection_id:void 0)&&(n="websocket_rails.unsubscribe",t=new WebSocketRails.Event([n,{data:{channel:this.name}},this.connection_id]),this._dispatcher.trigger_event(t)),this._callbacks={}},n.prototype.bind=function(t,n){var e;return null==(e=this._callbacks)[t]&&(e[t]=[]),this._callbacks[t].push(n)},n.prototype.unbind=function(t){return delete this._callbacks[t]},n.prototype.trigger=function(t,n){var e;return e=new WebSocketRails.Event([t,{channel:this.name,data:n,token:this._token},this.connection_id]),this._token?this._dispatcher.trigger_event(e):this._queue.push(e)},n.prototype.dispatch=function(t,n){var e,i,o,s,c,r;if("websocket_rails.channel_token"===t)return this.connection_id=null!=(s=this._dispatcher._conn)?s.connection_id:void 0,this._token=n.token,this.flush_queue();if(null!=this._callbacks[t]){for(c=this._callbacks[t],r=[],i=0,o=c.length;o>i;i++)e=c[i],r.push(e(n));return r}},n.prototype._success_launcher=function(t){return null!=this.on_success?this.on_success(t):void 0},n.prototype._failure_launcher=function(t){return null!=this.on_failure?this.on_failure(t):void 0},n.prototype.flush_queue=function(){var t,n,e,i;for(i=this._queue,n=0,e=i.length;e>n;n++)t=i[n],this._dispatcher.trigger_event(t);return this._queue=[]},n}()}.call(this);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t){if("function"==typeof define&&define.amd)define(t);else if("object"===("undefined"==typeof exports?"undefined":_typeof(exports)))module.exports=t();else{var n=window.Cookies,e=window.Cookies=t();e.noConflict=function(){return window.Cookies=n,e}}}(function(){function t(){for(var t=0,n={};t<arguments.length;t++){var e=arguments[t];for(var i in e)n[i]=e[i]}return n}function n(e){function i(n,o,s){var c;if("undefined"!=typeof document){if(arguments.length>1){if(s=t({path:"/"},i.defaults,s),"number"==typeof s.expires){var r=new Date;r.setMilliseconds(r.getMilliseconds()+864e5*s.expires),s.expires=r}try{c=JSON.stringify(o),/^[\{\[]/.test(c)&&(o=c)}catch(a){}return o=e.write?e.write(o,n):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=encodeURIComponent(String(n)),n=n.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),n=n.replace(/[\(\)]/g,escape),document.cookie=[n,"=",o,s.expires&&"; expires="+s.expires.toUTCString(),s.path&&"; path="+s.path,s.domain&&"; domain="+s.domain,s.secure?"; secure":""].join("")}n||(c={});for(var u=document.cookie?document.cookie.split("; "):[],h=/(%[0-9A-Z]{2})+/g,l=0;l<u.length;l++){var p=u[l].split("="),d=p.slice(1).join("=");'"'===d.charAt(0)&&(d=d.slice(1,-1));try{var _=p[0].replace(h,decodeURIComponent);if(d=e.read?e.read(d,_):e(d,_)||d.replace(h,decodeURIComponent),this.json)try{d=JSON.parse(d)}catch(a){}if(n===_){c=d;break}n||(c[_]=d)}catch(a){}}return c}}return i.set=i,i.get=function(t){return i(t)},i.getJSON=function(){return i.apply({json:!0},[].slice.call(arguments))},i.defaults={},i.remove=function(n,e){i(n,"",t(e,{expires:-1}))},i.withConverter=n,i}return n(function(){})}),document.addEventListener("DOMContentLoaded",function(){Kaanjo.socket.on_open=function(t){console.log("Connection established: "+t.connection_id),setTimeout(function(){Kaanjo.init()},500)}});var Kaanjo={init:function(){if(Kaanjo.hook=document.getElementById("kaanjo"),!Kaanjo.valid(Kaanjo.hook))return!1;for(var t in Kaanjo.attributes)Kaanjo.attributes[t]=Kaanjo.hook.getAttribute("data-"+t);Kaanjo.webmaster.init(function(){Kaanjo.customer.init(function(){Kaanjo.product.init(function(){Kaanjo.request("customer.impress",{device:detectBrowser(navigator.userAgent).name},function(t){console.log(t.msg),Kaanjo.get_html()})})})})},webmaster:{init:function(t){Kaanjo.request("webmaster.find",{key:Kaanjo.attributes.key},function(n){console.log(n.msg),t()},function(t){console.log(t.msg)})}},customer:{init:function(t){params={id:null},Kaanjo.customer.id=Kaanjo.cookies.get("kaanjo_cid"),Kaanjo.customer.id&&(params.id=Kaanjo.customer.id),Kaanjo.request("customer.find",params,function(n){Kaanjo.cookies.set("kaanjo_cid",n.sid),Kaanjo.customer.id=n.sid,console.log(n.msg),t()},function(t){console.log(t.msg)})}},product:{init:function(t){Kaanjo.request("product.find",{product:Kaanjo.attributes.product,url:window.location.href},function(n){Kaanjo.product.data=n.data,console.log(n.msg),t()},function(t){console.log(t.msg)})}},get_html:function(){Kaanjo.request("product.get_html",{},function(t){Kaanjo.hook.innerHTML=t.msg})},cookies:Cookies.noConflict(),socket:new WebSocketRails("kaanjo.co/websocket"),request:function(t,n,e,i){Kaanjo.socket.trigger(t,n,e,i)},react:function(t){Kaanjo.request("customer.react",{id:t})},valid:function(t){var n=!0;if(null==t)n=!1;else for(var e in Kaanjo.attributes)t.hasAttribute("data-"+e)||(console.error("Kaanjo: You are missing the '"+e+"' attribute in your HTML."),n=!1);return n},attributes:{key:null,product:null}};
//# sourceMappingURL=latest.js.map
