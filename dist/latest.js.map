{"version":3,"sources":["websocket_rails.0.0.1.min.js","js.cookie.js","detect-browser.js","plugin.js"],"names":[],"mappings":"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","file":"latest.js","sourcesContent":["(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};this.WebSocketRails=function(){function WebSocketRails(url,use_websockets){this.url=url,this.use_websockets=null!=use_websockets?use_websockets:!0,this.connection_stale=__bind(this.connection_stale,this),this.pong=__bind(this.pong,this),this.supports_websockets=__bind(this.supports_websockets,this),this.dispatch_channel=__bind(this.dispatch_channel,this),this.unsubscribe=__bind(this.unsubscribe,this),this.subscribe_private=__bind(this.subscribe_private,this),this.subscribe=__bind(this.subscribe,this),this.dispatch=__bind(this.dispatch,this),this.trigger_event=__bind(this.trigger_event,this),this.trigger=__bind(this.trigger,this),this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.connection_established=__bind(this.connection_established,this),this.new_message=__bind(this.new_message,this),this.reconnect=__bind(this.reconnect,this),this.callbacks={},this.channels={},this.queue={},this.connect()}return WebSocketRails.prototype.connect=function(){return this.state=\"connecting\",this._conn=this.supports_websockets()&&this.use_websockets?new WebSocketRails.WebSocketConnection(this.url,this):new WebSocketRails.HttpConnection(this.url,this),this._conn.new_message=this.new_message},WebSocketRails.prototype.disconnect=function(){return this._conn&&(this._conn.close(),delete this._conn._conn,delete this._conn),this.state=\"disconnected\"},WebSocketRails.prototype.reconnect=function(){var event,id,old_connection_id,_ref,_ref1;old_connection_id=null!=(_ref=this._conn)?_ref.connection_id:void 0,this.disconnect(),this.connect(),_ref1=this.queue;for(id in _ref1)event=_ref1[id],event.connection_id!==old_connection_id||event.is_result()||this.trigger_event(event);return this.reconnect_channels()},WebSocketRails.prototype.new_message=function(data){var event,socket_message,_i,_len,_ref,_results;for(_results=[],_i=0,_len=data.length;_len>_i;_i++)socket_message=data[_i],event=new WebSocketRails.Event(socket_message),event.is_result()?(null!=(_ref=this.queue[event.id])&&_ref.run_callbacks(event.success,event.data),delete this.queue[event.id]):event.is_channel()?this.dispatch_channel(event):event.is_ping()?this.pong():this.dispatch(event),_results.push(\"connecting\"===this.state&&\"client_connected\"===event.name?this.connection_established(event.data):void 0);return _results},WebSocketRails.prototype.connection_established=function(data){return this.state=\"connected\",this._conn.setConnectionId(data.connection_id),this._conn.flush_queue(),null!=this.on_open?this.on_open(data):void 0},WebSocketRails.prototype.bind=function(event_name,callback){var _base;return null==(_base=this.callbacks)[event_name]&&(_base[event_name]=[]),this.callbacks[event_name].push(callback)},WebSocketRails.prototype.unbind=function(event_name){return delete this.callbacks[event_name]},WebSocketRails.prototype.trigger=function(event_name,data,success_callback,failure_callback){var event,_ref;return event=new WebSocketRails.Event([event_name,data,null!=(_ref=this._conn)?_ref.connection_id:void 0],success_callback,failure_callback),this.trigger_event(event)},WebSocketRails.prototype.trigger_event=function(event){var _base,_name;return null==(_base=this.queue)[_name=event.id]&&(_base[_name]=event),this._conn&&this._conn.trigger(event),event},WebSocketRails.prototype.dispatch=function(event){var callback,_i,_len,_ref,_results;if(null!=this.callbacks[event.name]){for(_ref=this.callbacks[event.name],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)callback=_ref[_i],_results.push(callback(event.data));return _results}},WebSocketRails.prototype.subscribe=function(channel_name,success_callback,failure_callback){var channel;return null==this.channels[channel_name]?(channel=new WebSocketRails.Channel(channel_name,this,!1,success_callback,failure_callback),this.channels[channel_name]=channel,channel):this.channels[channel_name]},WebSocketRails.prototype.subscribe_private=function(channel_name,success_callback,failure_callback){var channel;return null==this.channels[channel_name]?(channel=new WebSocketRails.Channel(channel_name,this,!0,success_callback,failure_callback),this.channels[channel_name]=channel,channel):this.channels[channel_name]},WebSocketRails.prototype.unsubscribe=function(channel_name){return null!=this.channels[channel_name]?(this.channels[channel_name].destroy(),delete this.channels[channel_name]):void 0},WebSocketRails.prototype.dispatch_channel=function(event){return null!=this.channels[event.channel]?this.channels[event.channel].dispatch(event.name,event.data):void 0},WebSocketRails.prototype.supports_websockets=function(){return\"function\"==typeof WebSocket||\"object\"==typeof WebSocket},WebSocketRails.prototype.pong=function(){var pong,_ref;return pong=new WebSocketRails.Event([\"websocket_rails.pong\",{},null!=(_ref=this._conn)?_ref.connection_id:void 0]),this._conn.trigger(pong)},WebSocketRails.prototype.connection_stale=function(){return\"connected\"!==this.state},WebSocketRails.prototype.reconnect_channels=function(){var callbacks,channel,name,_ref,_results;_ref=this.channels,_results=[];for(name in _ref)channel=_ref[name],callbacks=channel._callbacks,channel.destroy(),delete this.channels[name],channel=channel.is_private?this.subscribe_private(name):this.subscribe(name),channel._callbacks=callbacks,_results.push(channel);return _results},WebSocketRails}()}).call(this),function(){WebSocketRails.Event=function(){function Event(data,success_callback,failure_callback){var attr;this.success_callback=success_callback,this.failure_callback=failure_callback,this.name=data[0],attr=data[1],null!=attr&&(this.id=null!=attr.id?attr.id:65536*(1+Math.random())|0,this.channel=null!=attr.channel?attr.channel:void 0,this.data=null!=attr.data?attr.data:attr,this.token=null!=attr.token?attr.token:void 0,this.connection_id=data[2],null!=attr.success&&(this.result=!0,this.success=attr.success))}return Event.prototype.is_channel=function(){return null!=this.channel},Event.prototype.is_result=function(){return\"undefined\"!=typeof this.result},Event.prototype.is_ping=function(){return\"websocket_rails.ping\"===this.name},Event.prototype.serialize=function(){return JSON.stringify([this.name,this.attributes()])},Event.prototype.attributes=function(){return{id:this.id,channel:this.channel,data:this.data,token:this.token}},Event.prototype.run_callbacks=function(success,result){return this.success=success,this.result=result,this.success===!0?\"function\"==typeof this.success_callback?this.success_callback(this.result):void 0:\"function\"==typeof this.failure_callback?this.failure_callback(this.result):void 0},Event}()}.call(this),function(){WebSocketRails.AbstractConnection=function(){function AbstractConnection(url,dispatcher){this.dispatcher=dispatcher,this.message_queue=[]}return AbstractConnection.prototype.close=function(){},AbstractConnection.prototype.trigger=function(event){return\"connected\"!==this.dispatcher.state?this.message_queue.push(event):this.send_event(event)},AbstractConnection.prototype.send_event=function(event){return null!=this.connection_id?event.connection_id=this.connection_id:void 0},AbstractConnection.prototype.on_close=function(event){var close_event;return this.dispatcher&&this.dispatcher._conn===this?(close_event=new WebSocketRails.Event([\"connection_closed\",event]),this.dispatcher.state=\"disconnected\",this.dispatcher.dispatch(close_event)):void 0},AbstractConnection.prototype.on_error=function(event){var error_event;return this.dispatcher&&this.dispatcher._conn===this?(error_event=new WebSocketRails.Event([\"connection_error\",event]),this.dispatcher.state=\"disconnected\",this.dispatcher.dispatch(error_event)):void 0},AbstractConnection.prototype.on_message=function(event_data){return this.dispatcher&&this.dispatcher._conn===this?this.dispatcher.new_message(event_data):void 0},AbstractConnection.prototype.setConnectionId=function(connection_id){this.connection_id=connection_id},AbstractConnection.prototype.flush_queue=function(){var event,_i,_len,_ref;for(_ref=this.message_queue,_i=0,_len=_ref.length;_len>_i;_i++)event=_ref[_i],this.trigger(event);return this.message_queue=[]},AbstractConnection}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};WebSocketRails.WebSocketConnection=function(_super){function WebSocketConnection(url,dispatcher){this.url=url,this.dispatcher=dispatcher,WebSocketConnection.__super__.constructor.apply(this,arguments),this.url.match(/^wss?:\\/\\//)?console.log(\"WARNING: Using connection urls with protocol specified is depricated\"):this.url=\"https:\"===window.location.protocol?\"wss://\"+this.url:\"ws://\"+this.url,this._conn=new WebSocket(this.url),this._conn.onmessage=function(_this){return function(event){var event_data;return event_data=JSON.parse(event.data),_this.on_message(event_data)}}(this),this._conn.onclose=function(_this){return function(event){return _this.on_close(event)}}(this),this._conn.onerror=function(_this){return function(event){return _this.on_error(event)}}(this)}return __extends(WebSocketConnection,_super),WebSocketConnection.prototype.connection_type=\"websocket\",WebSocketConnection.prototype.close=function(){return this._conn.close()},WebSocketConnection.prototype.send_event=function(event){return WebSocketConnection.__super__.send_event.apply(this,arguments),this._conn.send(event.serialize())},WebSocketConnection}(WebSocketRails.AbstractConnection)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};WebSocketRails.Channel=function(){function Channel(name,_dispatcher,is_private,on_success,on_failure){var event,event_name,_ref;this.name=name,this._dispatcher=_dispatcher,this.is_private=null!=is_private?is_private:!1,this.on_success=on_success,this.on_failure=on_failure,this._failure_launcher=__bind(this._failure_launcher,this),this._success_launcher=__bind(this._success_launcher,this),this._callbacks={},this._token=void 0,this._queue=[],event_name=this.is_private?\"websocket_rails.subscribe_private\":\"websocket_rails.subscribe\",this.connection_id=null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0,event=new WebSocketRails.Event([event_name,{data:{channel:this.name}},this.connection_id],this._success_launcher,this._failure_launcher),this._dispatcher.trigger_event(event)}return Channel.prototype.destroy=function(){var event,event_name,_ref;return this.connection_id===(null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0)&&(event_name=\"websocket_rails.unsubscribe\",event=new WebSocketRails.Event([event_name,{data:{channel:this.name}},this.connection_id]),this._dispatcher.trigger_event(event)),this._callbacks={}},Channel.prototype.bind=function(event_name,callback){var _base;return null==(_base=this._callbacks)[event_name]&&(_base[event_name]=[]),this._callbacks[event_name].push(callback)},Channel.prototype.unbind=function(event_name){return delete this._callbacks[event_name]},Channel.prototype.trigger=function(event_name,message){var event;return event=new WebSocketRails.Event([event_name,{channel:this.name,data:message,token:this._token},this.connection_id]),this._token?this._dispatcher.trigger_event(event):this._queue.push(event)},Channel.prototype.dispatch=function(event_name,message){var callback,_i,_len,_ref,_ref1,_results;if(\"websocket_rails.channel_token\"===event_name)return this.connection_id=null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0,this._token=message.token,this.flush_queue();if(null!=this._callbacks[event_name]){for(_ref1=this._callbacks[event_name],_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)callback=_ref1[_i],_results.push(callback(message));return _results}},Channel.prototype._success_launcher=function(data){return null!=this.on_success?this.on_success(data):void 0},Channel.prototype._failure_launcher=function(data){return null!=this.on_failure?this.on_failure(data):void 0},Channel.prototype.flush_queue=function(){var event,_i,_len,_ref;for(_ref=this._queue,_i=0,_len=_ref.length;_len>_i;_i++)event=_ref[_i],this._dispatcher.trigger_event(event);return this._queue=[]},Channel}()}.call(this);","/*!\n * JavaScript Cookie v2.1.2\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t} else if (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t} else {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\treturn (document.cookie = [\n\t\t\t\t\tkey, '=', value,\n\t\t\t\t\tattributes.expires && '; expires=' + attributes.expires.toUTCString(), // use expires attribute, max-age is not supported by IE\n\t\t\t\t\tattributes.path    && '; path=' + attributes.path,\n\t\t\t\t\tattributes.domain  && '; domain=' + attributes.domain,\n\t\t\t\t\tattributes.secure ? '; secure' : ''\n\t\t\t\t].join(''));\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.set = api;\n\t\tapi.get = function (key) {\n\t\t\treturn api(key);\n\t\t};\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","function detectBrowser(userAgentString) {\n  var browsers = [\n    [ 'edge', /Edge\\/([0-9\\._]+)/ ],\n    [ 'chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/ ],\n    [ 'firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/ ],\n    [ 'opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/ ],\n    [ 'opera', /OPR\\/([0-9\\.]+)(:?\\s|$)$/ ],\n    [ 'ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+)\\).*Gecko$/ ],\n    [ 'ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/ ],\n    [ 'ie', /MSIE\\s(7\\.0)/ ],\n    [ 'bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/ ],\n    [ 'android', /Android\\s([0-9\\.]+)/ ],\n    [ 'ios', /iPad.*Version\\/([0-9\\._]+)/ ],\n    [ 'ios',  /iPhone.*Version\\/([0-9\\._]+)/ ],\n    [ 'safari', /Version\\/([0-9\\._]+).*Safari/ ]\n  ];\n\n  var i = 0, mapped =[];\n  for (i = 0; i < browsers.length; i++) {\n    browsers[i] = createMatch(browsers[i]);\n    if (isMatch(browsers[i])) {\n      mapped.push(browsers[i]);\n    }\n  }\n\n  var match = mapped[0];\n  var parts = match && match[3].split(/[._]/).slice(0,3);\n\n  while (parts && parts.length < 3) {\n    parts.push('0');\n  }\n\n  function createMatch(pair) {\n    return pair.concat(pair[1].exec(userAgentString));\n  }\n\n  function isMatch(pair) {\n    return !!pair[2];\n  }\n\n  // return the name and version\n  return {\n    name: match && match[0],\n    version: parts && parts.join('.'),\n  };\n};\n","document.addEventListener(\"DOMContentLoaded\", () => { \n  \n  Kaanjo.socket.on_open = function(data) {\n    console.log(`Connection established: ${data.connection_id}`)\n    setTimeout(() => { \n      Kaanjo.init()\n    },500);\n  }\n\n});\n\nconst Kaanjo = {\n\n  init() {\n    \n    Kaanjo.hook = document.getElementById(\"kaanjo\");\n\n    if(!Kaanjo.valid(Kaanjo.hook))\n      return false\n\n    for(const attribute in Kaanjo.attributes) {\n      Kaanjo.attributes[attribute] = Kaanjo.hook.getAttribute(`data-${attribute}`);\n    }\n\n    Kaanjo.webmaster.init(() => {\n      Kaanjo.customer.init(() => {\n        Kaanjo.product.init(() => {\n          Kaanjo.request('customer.impress', {\n            device: detectBrowser(navigator.userAgent).name\n          },(success) => {\n            console.log(success.msg)\n            Kaanjo.get_html()\n          })\n        })\n      })\n    })\n    \n\n  },\n\n  webmaster: {\n    init(cb) {\n      Kaanjo.request( 'webmaster.find', \n        {\n          key: Kaanjo.attributes['key']\n        }, \n        (success) => { \n          console.log(success.msg)\n          cb();\n        }, \n        (fail) => { console.log(fail.msg); }\n      );\n    }\n  },\n\n  customer: {\n    init(cb) {\n      \n      params = { id: null }\n\n      Kaanjo.customer.id = Kaanjo.cookies.get('kaanjo_cid')\n      if(Kaanjo.customer.id) {\n        params.id = Kaanjo.customer.id\n      }\n\n      Kaanjo.request( 'customer.find', params,\n      (success) => {\n        Kaanjo.cookies.set('kaanjo_cid', success.sid);\n        Kaanjo.customer.id = success.sid;\n        console.log(success.msg)\n        cb()\n      },\n      (fail) => {\n        console.log(fail.msg)\n      })\n\n    }\n  },\n\n  product: {\n    init(cb) {\n      Kaanjo.request( 'product.find', {\n        product: Kaanjo.attributes.product,\n        url: window.location.href\n      }, \n      (success) => {\n        Kaanjo.product.data = success.data\n        console.log(success.msg)\n        cb();\n      }, \n      (fail) => { \n        console.log(fail.msg) \n      })\n    }\n  },\n\n  get_html() {\n    Kaanjo.request('product.get_html',{},\n    (html) => {\n      Kaanjo.hook.innerHTML = html.msg\n    })\n  },\n\n  cookies: Cookies.noConflict(),\n\n  //socket: new WebSocketRails('localhost:3000/websocket'),\n  socket: new WebSocketRails('kaanjo.co/websocket'),\n\n  request(action,data,success,fail) {\n    Kaanjo.socket.trigger(action,data,success,fail)\n  },\n\n  react(reaction_id) {\n    Kaanjo.request('customer.react',{\n      id: reaction_id\n    })\n  },\n\n  valid(hook) {\n\n    let is_valid = true;\n\n    if(hook == null) {\n      is_valid = false;\n\n    } else {\n\n      for(const attribute in Kaanjo.attributes) {\n\n        if(!hook.hasAttribute(`data-${attribute}`)) {\n          console.error(`Kaanjo: You are missing the '${attribute}' attribute in your HTML.`)\n          is_valid = false;\n        } \n\n      }\n    }\n\n    return is_valid;\n\n  },\n\n  attributes: {\n    key: null,\n    product: null\n  }\n\n}\n\nfunction cl(msg) {\n  console.log(msg)\n}\n"],"sourceRoot":"/source/"}